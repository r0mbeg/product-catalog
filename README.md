# product-catalog

1. Спроектировать схему БД - `init.sql`, заполнение данными - `insert.sql`.
1.1. Номенклатура (наименование, кол-во, цена) - таблица `products`.
1.2. Каталог номенклатуры/Дерево категорий - таблица `categories`.
1.3. Клиенты (наименование, адрес) - таблица `clients`.
1.4. Заказы покупателей. Необходимо предусмотреть возможность делать заказ из
разного набора товаров - таблицы `orders` и `orders_products`.

2. Написать следующие SQL запросы:
2.1 Получение информации о сумме товаров заказанных под каждого клиента (Наименование клиента, сумма) - файл `task_2.1.sql`.
2.2. Найти количество дочерних элементов первого уровня вложенности для категорий
номенклатуры - файл `task_2.2.sql`.
2.3 Топ 5 самых покупаемых товаров.
2.3.1 Написать текст запроса для отчета (view) «Топ-5 самых покупаемых товаров за
последний месяц» (по количеству штук в заказах). В отчете должны быть:
Наименование товара, Категория 1-го уровня, Общее количество проданных штук - файл `task_2.3.1.sql`.
2.3.2. Проанализировать написанный в п. 2.3.1 запрос и структуру БД. Предложить
варианты оптимизации этого запроса и общей схемы данных для повышения
производительности системы в условиях роста данных (тысячи заказов в день) - файл `task_2.3.2.sql`.

3. Написать сервис «Добавление товара в заказ» который работает по REST-API.
Метод должен принимать ID заказа, ID номенклатуры и количество. Если товар уже
есть в заказе, его количество должно увеличиваться, а не создаваться новая позиция.
Если товара нет в наличии то должна возвращаться соответствующая ошибка. Стек -
любой фреймворк в пределах Python. Git репозиторий, контейнеризация,
документация, и прочее — приветствуется.

Запуск - `docker compose up --build`. Документация Swagger - `localhost:8000/docs`.

**Пример.** После первого запуска добавим в заказ с `id=5` товар с `id=6` `6` товаров:

<pre>
curl -X 'POST' \
  'http://localhost:8000/orders/5/items' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "product_id": 6,
  "quantity": 6
}'
</pre>

ответ приходит такой:
<pre>
{
  "order_id": 5,
  "product_id": 6,
  "added_quantity": 6,
  "order_item_quantity": 7,
  "product_remaining_quantity": 9
}
</pre>